\documentclass[11pt,a4paper]{article}
\usepackage{tabulary}
\usepackage{geometry}
\geometry{
    a4paper,
    total={170mm,257mm},
    left=20mm,
    top=20mm,
}
\usepackage{color}
\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}
\newcommand{\SubItem}[1]{
    {\setlength\itemindent{15pt} \item[-] #1}
}

\begin{document}
\title{Polkadot Runtime Specification}
\author{Web3 Foundation}
\date{February 2020}
\maketitle

\section{Motivation}
Polkadot has a limited time window for block producers to create a block,
including limitations on block size which can make the selection and execution
of certain extrinsics too expensive and decelerate the network. The weight
system introduces a mechanism for block producers to *measure* the expense of
extrinsics and determine how *heavy* it is. With this mechanism, block producers
can select a set of extrinsics and saturate the block to it's fullest potential
without exceeding any limitations.
\newline

Polkadot also introduces a specified block ratio, ensuring that only a certain
portion of the total block size gets used for regular extrinsics. The remaining
space is reserved for critical, operational extrinsics required for the functionality 
by Polkadot itself.

\section{Weight Assignment}
Assigning weights based on theoretical performance such as big O notation proves to be
unreliable and too complex due to imprecision in back-end systems, internal communication
within the Runtime and design choices in the software. Therefore, all available Runtime 
functions, which create and execute extrinsics, have to be benchmarked with a large
collection of input parameters.

\subsection{Parameters}
The inputs parameters highly vary depending on the Runtime function and must therefore
be carefully selected. The benchmarks should use parameters which will most likely be
used in regular cases, as intended by the authors, but must also consider worst case
scenarios and inputs which might decelerate or heavily impact performance of the function.
The input parameters should be randomized in order to cause various effects in behaviors
on certain values, such as memory relocations and other results that can impact performance
and resource devastation.

\subsection{Blockchain State}
The benchmarks should be performed on blockchain states that already contain a history of
extrinsics and storage changes. Runtime functions that required read/writing on structures
such as Tries will therefore produce more realistic results that will reflect the real-world
performance of the Runtime.

\subsection{Environment}
The benchmarks should be executed on clean systems without interference of other processes
or software. Additionally, the benchmarks should be executed multiple machines with different
system resources, such as CPU performance, CPU cores, RAM and storage speed.

\section{Chosen Parameters for Polkadot}
This section describes the chosen parameters for the Polkadot Runtime functions.\todo{tag/revision}

\subsection{Balances}

\textbf{Variables per benchmark}
\begin{itemize}
\item INDEX in 1 to 1000
\item BALANCE in 2 to 1000
\end{itemize}

\subsubsection{transfer\_worst\_case}

Benchmark \verb|transfer| with the worst possible conditions:
\begin{itemize}
\item Transfer will kill the origin account.
\item Transfer will create the destination account.
\end{itemize}

Function prototype:

\begin{verbatim}
    transfer(origin, destination, value)
\end{verbatim}

\textbf{Environment preparation}
\begin{itemize}
\item Origin account balance: BALANCE
\item Destination account balance: none
\end{itemize}

Parameter: \verb|origin|
\begin{itemize}
\item Account name: "caller"
\item Account index: INDEX
\item Seed: 0
\end{itemize}

Parameter: \verb|destination|
\begin{itemize}
\item Account name: "recipient"
\item Account index: INDEX
\item Seed: 0
\end{itemize}

Parameter: \verb|value|
\begin{itemize}
\item Balance: BALANCE - 1
\item Unit: 1
\end{itemize}

\subsection{transfer\_best\_case}

Benchmark \verb|transfer| with the best possible conditions:
\begin{itemize}
\item Origin account already exists and will continue to exists.
\item Destination account already exists and will continue to exists.
\end{itemize}

Function prototype:

\begin{verbatim}
    transfer(origin, destination, value)
\end{verbatim}

\textbf{Environment preparation}
\begin{itemize}
\item Origin account balance: max balance
\item Destination account balance: existential deposit
\end{itemize}

Parameter: \verb|origin|
\begin{itemize}
\item Account name: "caller"
\item Account index: INDEX
\item Seed: 0.
\end{itemize}

Parameter: \verb|destination|
\begin{itemize}
\item Account name: "recipient"
\item Account index: INDEX
\item Seed: 0
\end{itemize}

Parameter: \verb|value|
\begin{itemize}
\item Balance: BALANCE
\end{itemize}

\subsection{transfer\_keep\_alive}

Benchmark \verb|transfer_keep_alive| with the worst possible conditions:
\begin{itemize}
\item Destination account is created.
\end{itemize}

Function prototype:

\begin{verbatim}
    transfer_keep_alive(origin, destination, value)
\end{verbatim}

\textbf{Environment preparation}
\begin{itemize}
\item Origin account balance: max balance
\item Destination account balance: none
\end{itemize}

Parameter: \verb|origin|
\begin{itemize}
\item Account name: "caller"
\item Account index: INDEX
\item Seed: 0.
\end{itemize}

Parameter: \verb|destination|
\begin{itemize}
\item Account name: "recipient"
\item Account index: INDEX
\item Seed: 0
\end{itemize}

Parameter: \verb|value|
\begin{itemize}
\item Balance: BALANCE
\end{itemize}

\subsection{set\_balance}

Benchmark \verb|set_balance| coming from ROOT account, which always results in account creation.

Function prototype:

\begin{verbatim}
    set_balance(origin, who, free_value, reserved_value)
\end{verbatim}

\textbf{Environment preparation}
\begin{itemize}
\item Origin account balance: max balance
\item Destination account balance: none
\end{itemize}

Parameter: \verb|origin|
\begin{itemize}
\item Account name: ROOT
\end{itemize}

Parameter: \verb|destination|
\begin{itemize}
\item Account name: "user"
\item Account index: INDEX
\item Seed: 0
\end{itemize}

Parameter: \verb|free_value|
\begin{itemize}
\item Balance: BALANCE
\end{itemize}

Parameter: \verb|reserved_value|
\begin{itemize}
\item Balance: BALANCE
\end{itemize}

\subsection{set\_balance\_killing}

Benchmark \verb|set_balance| coming from ROOT account, which results in account termination.

Function prototype:

\begin{verbatim}
    set_balance(origin, who, free_value, reserved_value)
\end{verbatim}



\end{document}